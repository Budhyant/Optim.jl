<!DOCTYPE html>
<html lang="en">
<head>
  
  
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <meta name="author" content="JuliaNLSolvers">
    
    <link rel="shortcut icon" href="../../../img/favicon.ico">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" />
    <title>Maximum likelihood estimation - Optim.jl</title>
    <link href="../../../css/bootstrap-3.3.7.min.css" rel="stylesheet">
    <link href="../../../css/font-awesome-4.7.0.css" rel="stylesheet">
    <link href="../../../css/base.css" rel="stylesheet">
    <link rel="stylesheet" href="../../../css/highlight.css">
    <link href="../../../assets/Documenter.css" rel="stylesheet">
    <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
        <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
    <![endif]-->

    <script src="../../../js/jquery-3.2.1.min.js"></script>
    <script src="../../../js/bootstrap-3.3.7.min.js"></script>
    <script src="../../../js/highlight.pack.js"></script>
    
    <base target="_top">
    <script>
      var base_url = '../../..';
      var is_top_frame = false;
        
        var pageToc = [
          {title: "Maximum Likelihood Estimation: The Normal Linear Model", url: "#_top", children: [
              {title: "Plain Program", url: "#plain-program" },
          ]},
        ];

    </script>
    <script src="../../../js/base.js"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS_HTML"></script>
      <script src="../../../assets/mathjaxhelper.js"></script> 
</head>

<body>
<script>
if (is_top_frame) { $('body').addClass('wm-top-page'); }
</script>



<div class="container-fluid wm-page-content">
  <a name="_top"></a>
    

    
    
      
      
    

  <div class="row wm-article-nav-buttons" role="navigation" aria-label="navigation">
    
    <div class="wm-article-nav pull-right">
      <a href="../rasch/" class="btn btn-xs btn-default pull-right">
        Next
        <i class="fa fa-chevron-right" aria-hidden="true"></i>
      </a>
      <a href="../rasch/" class="btn btn-xs btn-link">
        Conditional maximum likelihood estimation
      </a>
    </div>
    
    <div class="wm-article-nav">
      <a href="../ipnewton_basics/" class="btn btn-xs btn-default pull-left">
        <i class="fa fa-chevron-left" aria-hidden="true"></i>
        Previous</a><a href="../ipnewton_basics/" class="btn btn-xs btn-link">
        Interior point Newton
      </a>
    </div>
    
  </div>

    

    <p><a id='Maximum-Likelihood-Estimation:-The-Normal-Linear-Model-1'></a></p>
<h1 id="maximum-likelihood-estimation-the-normal-linear-model">Maximum Likelihood Estimation: The Normal Linear Model</h1>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>This example is also available as a Jupyter notebook: <a href="https://nbviewer.jupyter.org/github/JuliaNLSolvers/Optim.jl/blob/gh-pages/v0.19.1/examples/generated/maxlikenlm.ipynb"><code>maxlikenlm.ipynb</code></a></p>
</div>
<p>The following tutorial will introduce maximum likelihood estimation in Julia for the normal linear model.</p>
<p>The normal linear model (sometimes referred to as the OLS model) is the workhorse of regression modeling and is utilized across a number of diverse fields.  In this tutorial, we will utilize simulated data to demonstrate how Julia can be used to recover the parameters of interest.</p>
<p>The first order of business is to use the <code>Optim</code> package and also include the <code>NLSolversBase</code> routine:</p>
<pre><code class="julia">using Optim, NLSolversBase, Random
using LinearAlgebra: diag
Random.seed!(0);                            # Fix random seed generator for reproducibility
</code></pre>

<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>Add Optim with the following command at the Julia command prompt: <code>Pkg.add("Optim")</code></p>
</div>
<p>The first item that needs to be addressed is the data generating process or DGP. The following code will produce data from a nomral linear model:</p>
<pre><code class="julia">n = 500                             # Number of observations
nvar = 2                            # Number of variables
β = ones(nvar) * 3.0                # True coefficients
x = [ones(n) randn(n, nvar - 1)]    # X matrix of explanatory variables plus constant
ε = randn(n) * 0.5                  # Error variance
y = x * β + ε;                      # Generate Data
</code></pre>

<p>In the above example, we have 500 observations, 2 explanatory variables plus an intercept, an error variance equal to 0.5, coefficients equal to 3.0, and all of these are subject to change by the user. Since we know the true value of these parameters, we should obtain these values when we maximize the likelihood function.</p>
<p>The next step in our tutorial is to define a Julia function for the likelihood function. The following function defines the likelihood function for the normal linear model:</p>
<pre><code class="julia">function Log_Likelihood(X, Y, β, log_σ)
    σ = exp(log_σ)
    llike = -n/2*log(2π) - n/2* log(σ^2) - (sum((Y - X * β).^2) / (2σ^2))
    llike = -llike
end
</code></pre>

<pre><code>Log_Likelihood (generic function with 1 method)
</code></pre>

<p>The log likelihood function accepts 4 inputs: the matrix of explanatory variables (X), the dependent variable (Y), the β's, and the error varicance. Note that we exponentiate the error variance in the second line of the code because the error variance cannot be negative and we want to avoid this situation when maximizing the likelihood.</p>
<p>The next step in our tutorial is to optimize our function. We first use the <code>TwiceDifferentiable</code> command in order to obtain the Hessian matrix later on, which will be used to help form t-statistics:</p>
<pre><code class="julia">func = TwiceDifferentiable(vars -&gt; Log_Likelihood(x, y, vars[1:nvar], vars[nvar + 1]),
                           ones(nvar+1); autodiff=:forward);
</code></pre>

<p>The above statment accepts 4 inputs: the x matrix, the dependent variable y, and a vector of β's and the error variance.  The <code>vars[1:nvar]</code> is how we pass the vector of β's and the <code>vars[nvar + 1]</code> is how we pass the error variance. You can think of this as a vector of parameters with the first 2 being β's and the last one is the error variance.</p>
<p>The <code>ones(nvar+1)</code> are the starting values for the parameters and the <code>autodiff=:forward</code> command performs forward mode automatic differentiation.</p>
<p>The actual optimization of the likelihood function is accomplished with the following command:</p>
<pre><code class="julia">opt = optimize(func, ones(nvar+1))
</code></pre>

<pre><code> * Status: success

 * Candidate solution
    Minimizer: [3.00e+00, 2.96e+00, -6.49e-01]
    Minimum:   3.851229e+02

 * Found with
    Algorithm:     Newton's Method
    Initial Point: [1.00e+00, 1.00e+00, 1.00e+00]

 * Convergence measures
    |x - x'|               = 2.62e-08 ≰ 0.0e+00
    |x - x'|/|x'|          = 8.72e-09 ≰ 0.0e+00
    |f(x) - f(x')|         = 5.12e-13 ≰ 0.0e+00
    |f(x) - f(x')|/|f(x')| = 1.33e-15 ≰ 0.0e+00
    |g(x)|                 = 3.41e-13 ≤ 1.0e-08

 * Work counters
    Iterations:    7
    f(x) calls:    31
    ∇f(x) calls:   31
    ∇²f(x) calls:  7
</code></pre>

<p>The first input to the command is the function we wish to optimize and the second input are the starting values.</p>
<p>After a brief period of time, you should see output of the optimization routine, with the parameter  estimates being very close to our simulated values.</p>
<p>The optimization routine stores several quantities and we can obtain the maximim likelihood estimates with the following command:</p>
<pre><code class="julia">parameters = Optim.minimizer(opt)
</code></pre>

<pre><code>3-element Array{Float64,1}:
  3.002788633849947
  2.964549617572727
 -0.648692780562844
</code></pre>

<p>!!! Note     Fieldnames for all of the quantities can be obtained with the following command:     fieldnames(opt)</p>
<p>Since we paramaterized our likelihood to use the exponentiated value, we need to exponentiate it to get back to our original log scale:</p>
<pre><code class="julia">parameters[nvar+1] = exp(parameters[nvar+1])
</code></pre>

<pre><code>0.5227286513837306
</code></pre>

<p>In order to obtain the correct Hessian matrix, we have to "push" the actual parameter values that maximizes the likelihood function since the <code>TwiceDifferentiable</code> command uses the next to last values to calculate the Hessian:</p>
<pre><code class="julia">numerical_hessian = hessian!(func,parameters)
</code></pre>

<pre><code>3×3 Array{Float64,2}:
 175.766        -12.0877        5.67464e-14
 -12.0877       182.437         5.88344e-15
   5.67464e-14    5.88344e-15  96.0542
</code></pre>

<p>We can now invert our Hessian matrix to obtain the variance-covariance matrix:</p>
<pre><code class="julia">var_cov_matrix = inv(numerical_hessian)
</code></pre>

<pre><code>3×3 Array{Float64,2}:
  0.00571544    0.000378687  -3.39973e-18
  0.000378687   0.00550643   -5.60994e-19
 -3.39973e-18  -5.60994e-19   0.0104108
</code></pre>

<p>In this example, we are only interested in the statistical significance of the coefficient estimates so we obtain those with the following command:</p>
<pre><code class="julia">β = parameters[1:nvar]
</code></pre>

<pre><code>2-element Array{Float64,1}:
 3.002788633849947
 2.964549617572727
</code></pre>

<p>We now need to obtain those elements of the variance-covariance matrix needed to obtain our t-statistics, and we can do this with the following commands:</p>
<pre><code class="julia">temp = diag(var_cov_matrix)
temp1 = temp[1:nvar]
</code></pre>

<pre><code>2-element Array{Float64,1}:
 0.005715441191953887
 0.005506430533329349
</code></pre>

<p>The t-statistics are formed by dividing element-by-element the coefficients by their standard errors, or the square root of the diagonal elements of the variance-covariance matrix:</p>
<pre><code class="julia">t_stats = β./sqrt.(temp1)
</code></pre>

<pre><code>2-element Array{Float64,1}:
 39.719144251161474
 39.95063081460274
</code></pre>

<p>From here, one may examine other statistics of interest using the output from the optimization routine.</p>
<p><a id='maxlikenlm-plain-program-1'></a></p>
<h2 id="plain-program">Plain Program</h2>
<p>Below follows a version of the program without any comments. The file is also available here: <a href="../maxlikenlm.jl">maxlikenlm.jl</a></p>
<pre><code class="julia">using Optim, NLSolversBase, Random
using LinearAlgebra: diag
Random.seed!(0);                            # Fix random seed generator for reproducibility

n = 500                             # Number of observations
nvar = 2                            # Number of variables
β = ones(nvar) * 3.0                # True coefficients
x = [ones(n) randn(n, nvar - 1)]    # X matrix of explanatory variables plus constant
ε = randn(n) * 0.5                  # Error variance
y = x * β + ε;                      # Generate Data

function Log_Likelihood(X, Y, β, log_σ)
    σ = exp(log_σ)
    llike = -n/2*log(2π) - n/2* log(σ^2) - (sum((Y - X * β).^2) / (2σ^2))
    llike = -llike
end

func = TwiceDifferentiable(vars -&gt; Log_Likelihood(x, y, vars[1:nvar], vars[nvar + 1]),
                           ones(nvar+1); autodiff=:forward);

opt = optimize(func, ones(nvar+1))

parameters = Optim.minimizer(opt)

parameters[nvar+1] = exp(parameters[nvar+1])

numerical_hessian = hessian!(func,parameters)

var_cov_matrix = inv(numerical_hessian)

β = parameters[1:nvar]

temp = diag(var_cov_matrix)
temp1 = temp[1:nvar]

t_stats = β./sqrt.(temp1)

# This file was generated using Literate.jl, https://github.com/fredrikekre/Literate.jl
</code></pre>

<p><em>This page was generated using <a href="https://github.com/fredrikekre/Literate.jl">Literate.jl</a>.</em></p>

  <br>
    

    
    
      
      
    

  <div class="row wm-article-nav-buttons" role="navigation" aria-label="navigation">
    
    <div class="wm-article-nav pull-right">
      <a href="../rasch/" class="btn btn-xs btn-default pull-right">
        Next
        <i class="fa fa-chevron-right" aria-hidden="true"></i>
      </a>
      <a href="../rasch/" class="btn btn-xs btn-link">
        Conditional maximum likelihood estimation
      </a>
    </div>
    
    <div class="wm-article-nav">
      <a href="../ipnewton_basics/" class="btn btn-xs btn-default pull-left">
        <i class="fa fa-chevron-left" aria-hidden="true"></i>
        Previous</a><a href="../ipnewton_basics/" class="btn btn-xs btn-link">
        Interior point Newton
      </a>
    </div>
    
  </div>

    <br>
</div>

<footer class="col-md-12 wm-page-content">
      <p>
        <a href="https://github.com/JuliaNLSolvers/Optim.jl/edit/master/docs/examples/generated/maxlikenlm.md"><i class="fa fa-github"></i>
Edit on GitHub</a>
      </p>
  <p>Documentation built with <a href="http://www.mkdocs.org/">MkDocs</a> using <a href="https://github.com/gristlabs/mkdocs-windmill">Windmill</a> theme by Grist Labs.</p>
</footer>

</body>
</html>